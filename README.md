[![Build Status](https://travis-ci.org/move-elevator/humhub-composer-installer.svg?branch=master)](https://travis-ci.org/move-elevator/humhub-composer-installer)
[![Software License](https://img.shields.io/badge/license-MIT-brightgreen.svg)](LICENSE)
[![Latest Stable Version](https://poser.pugx.org/move-elevator/humhub-composer-installer/v/stable)](https://packagist.org/packages/move-elevator/humhub-composer-installer)
[![Total Downloads](https://poser.pugx.org/move-elevator/humhub-composer-installer/downloads)](https://packagist.org/packages/move-elevator/humhub-composer-installer)

### Humhub Composer Installer

This package installs HumHub in version 1.2.* into a web directory which can be configured in the composer.json of your project and is relative to the project-vendor dir(`humhub: web-dir`).
You can also configure a configuration directory (`humhub: config-dir`). In that directory you can put a project index.php, .htaccess and protected/yii which will be symlinked into the humhub web directory.

You can also configure a folder for your own modules directory (`humhub: module-dir`) and  for the themes directory (`humhub: theme-dir`) These will also be symlinked into the humhub web directory and should be relative to the project-vendor-dir.

If there aren't any configuration files (index.php, protected/yii) provided by your project, this package will install default configuration files. These you can find in the `etc/config` directory of this package.

The whole web-directory will regenerated by any composer update or install. The generated symlinks are relative paths, so they can be compressed, for example as tar or zip file. ThatÂ´s important for deployments or any other movement of the project,  

## To install Humhub:
Add the following lines to the composer.json of your project:
```
{
  "minimum-stability": "dev",
  "require": {
    "oomphinc/composer-installers-extender": "^1.1",
    "bower-asset/select2-bootstrap-theme": "0.1.0-beta.4",
    "humhub/humhub": "v1.2.3",
    "move-elevator/humhub-composer-installer": "~1.0"
  },
  "autoload": {
    "psr-4": {
      "humhub\\": "web/protected/humhub",
      "humhub\\modules\\": "web/protected/modules"
    }
  },
  "repositories": [
    {
      "type": "vcs",
      "url": "https://github.com/humhub/humhub.git"
    },
    {
      "type": "composer",
      "url": "https://asset-packagist.org"
    }
  ],
  "scripts": {
    "post-update-cmd": [
      "MoveElevator\\Composer\\Installer::initialize"
    ],
    "post-install-cmd": [
      "MoveElevator\\Composer\\Installer::initialize"
    ]
  },
  "extra": {
    "humhub": {
      "web-dir": "../web",
      "config-dir": "../etc/config",
      "module-dir": "../modules",
      "theme-dir": "../themes"
    },
    "asset-installer-paths": {
      "npm-asset-library": "htdocs/protected/vendor/npm",
      "bower-asset-library": "htdocs/protected/vendor/bower"
    },
    "installer-types": [
      "bower-asset",
      "npm-asset"
    ],
    "installer-paths": {
      "public/assets/{$vendor}/{$name}/": [
        "type:bower-asset",
        "type:npm-asset"
      ]
    }
  }
}
```

## Checks
Run each command in the current package root directory.

### Execute PHPUnit tests

```
./vendor/bin/phpunit.phar -c ./phpunit.xml --debug --verbose
```

### Execute PHPMD checks

```
./vendor/bin/phpmd.phar ./src text ./phpmd.xml
```

### Execute PHPSTAN checks

```
./vendor/bin/phpstan.phar analyse -l 7 ./src
```

### Execute copy paste detection

```
./vendor/bin/phpcpd.phar ./src 
```

### Execute checkstyle for PSR2

```
./vendor/bin/phpcs.phar ./src --standard=PSR2 
```

### TroubleShooting

- This package could not handle a vendor-, web-, config-, theme- or module-directory outside the project root-directory.
- There will be created no `uploads`-directory from this package. you can link a global directory to uploads after a deployment. so you can prevent to lose all your previous uploads.
- Updates or downloads from the online marketplace, will be downloaded into the folder `vendor/humhub/humhub/protected/modules` and should be moved to your origin `module-dir`.
  - At the moment there is no possibility in humhub to reconfigure these download-folder.
  - After install a new module and move to the origin `module-dir` you should rerun the install script of this package. If you use the example above, you can run `composer run-script post-update-cmd`  

### TODO

- test and implement install for windows system

